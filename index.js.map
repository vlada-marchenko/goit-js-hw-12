{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from \"axios\"\n\nexport const input = document.querySelector('.input')\nexport let page = 1\nexport let perPage = 15\nexport let totalPages = 0\n\nexport function resetPage() {\n    page = 1\n    totalPages = 0\n}\n\nconst api_key = '48786073-6183322621e5d0cfd6fc221bb'\n\n\nexport default async function request(query, currentPage) {\n    if(!query) {\n        return Promise.resolve({ hits: [], totalHits: 0 });\n        // return Promise.resolve(null)\n    }\n\n    // if (totalPages && currentPage > totalPages) {\n    //     return Promise.resolve([]);\n    // }\n\n    // if (totalPages && currentPage > totalPages) {\n    //     return { hits: [], totalHits: 0 };\n    // }\n\n    try {\n    const fetch = await axios.get('https://pixabay.com/api/', {\n        params: {\n        key: api_key,\n        q: query.toLowerCase(),\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: 'true',\n        page: currentPage,\n        per_page: perPage\n        }\n    })\n\n    const { totalHits, hits } = fetch.data;\n    totalPages = Math.ceil(totalHits / perPage);\n\n    // if (currentPage > totalPages && totalPages !== 0) {\n    //     return { hits: [], totalHits };\n    //   }\n\n    // const totalHits = fetch.data.totalHits\n    // totalPages = Math.ceil(totalHits / perPage)\n\n    //  if (currentPage > totalPages) {\n    //   return []\n    // }\n\n    return { hits, totalHits }\n} catch(err)  {\n        console.error('API request failed:', err)\n        return { hits: [], totalHits: 0 }\n}\n}\n\nexport function incrementPage() {\n    page += 1;\n}","import SimpleLightbox from \"simplelightbox\"\nimport \"simplelightbox/dist/simple-lightbox.min.css\"\n\nexport const gallery = document.querySelector('.gallery')\nexport const loader = document.querySelector('.loader')\nexport const loadMoreButton = document.querySelector('.load-more')\nexport let lightbox = new SimpleLightbox('.gallery a')\n\nexport default function createMarkup(arr) {\n    return arr.map(({ webformatURL, largeImageURL, tags, likes, views, comments, downloads }) => \n    `\n    <li class=\"pic\">\n      <a href=\"${largeImageURL}\" target=\"_blank\">\n        <div class=\"pic-card\">\n          <img src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" width=\"100%\" height=\"220px\"/>\n          <div class=\"info\">\n            <p class=\"info-item\"><b> <span>Likes</span></b> ${likes}</p>\n            <p class=\"info-item\"><b> <span>Views</span></b> ${views}</p>\n            <p class=\"info-item\"><b> <span>Comments</span></b> ${comments}</p>\n            <p class=\"info-item\"><b> <span>Downloads</span></b> ${downloads}</p>\n          </div>\n        </div>\n      </a>\n    </li>\n    `\n    ).join('')\n}\n\n\nexport function renderGallery(arr) {\n  const markup = createMarkup(arr)\n  gallery.insertAdjacentHTML('beforeend', markup)\n  lightbox.refresh();\n}\n\nexport function clearGallery() {\n  gallery.innerHTML = ''\n}\n\n\n","import request, { input, page, totalPages, resetPage, incrementPage } from \"./js/pixabay-api.js\";\nimport { \n    renderGallery, \n    clearGallery\n  } from './js/render-functions.js'\n\nimport iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\n\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\n// const button_search = document.querySelector('.button')\nconst form = document.querySelector('.form')\nconst loader = document.querySelector('.loader')\nlet btnLoad = document.querySelector('.btn')\nlet query = ''\nlet currentPage = 1;\n\n\nform.addEventListener('submit', handleSubmit)\nbtnLoad.addEventListener('click', handleClick)\n\nfunction showElement(element) {\n    element.style.display = 'block'\n}\n\nfunction hideElement(element) {\n    element.style.display = 'none'\n}\n\nasync function handleSubmit(evt) {\n    evt.preventDefault()\n\n    showElement(loader)\n    query = input.value.trim()\n\n    if (!query) {\n        hideElement(loader)\n        return\n    }\n\n    clearGallery()\n    // currentPage = 1;\n    resetPage()\n    // currentPage = 1\n\n        try {\n            const { hits, totalHits } = await request(query, page)\n\n        if (!hits.length) {\n            iziToast.error({\n                message: 'Sorry, there are no images matching your search query. Please try again!',\n                position: \"bottomRight\"\n            });\n            hideElement(btnLoad)\n            return\n        } \n\n        renderGallery(hits)\n\n        \n        // const totalPages = Math.ceil(data.totalHits / perPage)\n\n        if (page < totalPages) {\n            showElement(btnLoad)\n        } else {\n            hideElement(btnLoad)\n        }\n\n\n    } catch (err) {\n        console.error(err)\n        hideElement(btnLoad)\n    } finally {\n        hideElement(loader)\n        // form.reset()\n    }\n\n\n}\n\nasync function handleClick() {\n    showElement(loader)\n    incrementPage()\n\n    try {\n        const { hits } = await request(query, page)\n\n        if (!hits.length) {\n            iziToast.info({\n                message: \"We're sorry, but you've reached the end of search results.\",\n                position: \"bottomRight\"\n            })\n            hideElement(btnLoad)\n            return\n        }\n\n        renderGallery(hits)\n        scroll()\n\n        // const totalPages = Math.ceil(data.totalHits / perPage)\n\n        if (page  >= totalPages) {\n            hideElement(btnLoad)\n            iziToast.info({\n                message: \"We're sorry, but you've reached the end of search results.\",\n                position: \"bottomRight\"\n            });\n        }\n\n    } catch (err) {\n        console.error(err)\n        hideElement(btnLoad)\n    } finally {\n        hideElement(loader)\n    }\n}\n\nfunction scroll() {\n    const pic = document.querySelectorAll('.pic');\n\n\n    if (pic.length > 0) {\n        const rect = pic[0].getBoundingClientRect().height; \n\n        window.scrollBy({\n            top: rect * 2, \n            behavior: 'smooth' \n        });\n    }\n}\n"],"names":["input","page","perPage","totalPages","resetPage","api_key","request","query","currentPage","fetch","axios","totalHits","hits","err","incrementPage","gallery","lightbox","SimpleLightbox","createMarkup","arr","webformatURL","largeImageURL","tags","likes","views","comments","downloads","renderGallery","markup","clearGallery","form","loader","btnLoad","handleSubmit","handleClick","showElement","element","hideElement","evt","iziToast","scroll","pic","rect"],"mappings":"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"}